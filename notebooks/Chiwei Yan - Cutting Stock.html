<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="JuliaOpt - Optimization packages for the Julia language">
    <meta name="author" content="Iain Dunning">
    <link rel="icon" href="favicon.ico">

    <title>JuliaOpt - Optimization packages for the Julia language</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <!-- Additional styles -->
    <style>
      body {
        padding-top: 60px;
        padding-bottom: 20px;
      }
    </style>
    <style type="text/css">
    .highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="container">


      <!-- Static navbar -->
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/index.html">JuliaOpt</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li><a href="#about">About</a></li>
              <li><a href="#packages">Packages</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  <li><a href="#">Action</a></li>
                  <li><a href="#">Another action</a></li>
                  <li><a href="#">Something else here</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Nav header</li>
                  <li><a href="#">Separated link</a></li>
                  <li><a href="#">One more separated link</a></li>
                </ul>
              </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </nav>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Description</strong>: Shows how to implement column generation in JuMP for solving the cutting stock problem.</p>
<p><strong>Author</strong>: Chiwei Yan</p>
<p><strong>License</strong>: <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Cutting-Stock-Problem-Using-Julia/JuMP">Cutting Stock Problem Using Julia/JuMP<a class="anchor-link" href="#Cutting-Stock-Problem-Using-Julia/JuMP">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this notebook, we deploy column generation to solve the cutting stock problem using Julia/JuMP. The origin of the cutting stock problem is in the paper industry. Given paper rolls of fixed width and a set of orders for rolls of smaller widths, the objective of the cutting stock problem is to determine how to cut the rolls into smaller widths to fulfill the orders in such a way as to minimize the amount of scrap. The cutting stock problem example we use in this notebook is from <em>Linear Programming</em> by Vasek Chvatal, 1983.</p>
<p>Suppose that rolls are produced in a uniform width of 100 inches and that orders can be placed for rolls of widths 14 inches, 31 inches, 36 inches, and 45 inches. The company has received the following orders:</p>
\begin{array}{|c|c|}
\hline \textrm{Order Width} & \textrm{Quantity} \\\hline
  14  & 211 \\\hline
  31  & 395 \\\hline
  36  & 610 \\\hline
  45  & 97 \\\hline
\end{array}<p>A single 100 inch roll can be cut into one or more of the order widths. For example, one roll could be cut into two rolls of 45 inches with a 10 inch roll of scrap.</p>
<p><img src="http://neos-server.org/casestudies/cutting/roll.gif"></p>
<p>Or a roll could be cut into a roll of 45 inches, a roll of 31 inches, and a roll of 14 inches with no scrap. Each such possible combination is called a pattern. For this example, there are 37 different patterns. Determining how many of each pattern to cut to satisfy the customer orders while minimizing the scrap is too difficult to do by hand. Instead the problem can be formulated as an optimization problem, specifically an integer linear program.</p>
<h3 id="Mathematical-Formulation">Mathematical Formulation<a class="anchor-link" href="#Mathematical-Formulation">&#182;</a></h3><p><strong>Sets</strong></p>
<ul>
<li>$I$ = set of order widths</li>
<li>$J$ = set of patterns</li>
</ul>
<p><strong>Parameters</strong></p>
<ul>
<li>$a_{ij}$ = number of rolls of width $i$ cut in pattern $j$</li>
<li>$b_i$ = demand for order width $i$</li>
</ul>
<p><strong>Decision Variables</strong></p>
<ul>
<li>$x_j$ = number of rolls cut using pattern $j$</li>
</ul>
<p>The objective of the cutting stock problem is to minimize the number of rolls cut subject to cutting enough rolls to satisfy the customer orders. Using the notation above, the problem can be formulated as follows:</p>
$$\begin{align}
\nonumber
\min\qquad &\sum_{j\in J}x_j \\ \nonumber
\textrm{s.t.}\qquad &\sum_{j\in J}a_{ij}x_j\ge b_i,~\forall i\in I \\ \nonumber
&x_j\in\textrm{integer},~\forall j\in J
\end{align}$$
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Let's-see-how-to-formulate-this-problem-in-JuMP">Let's see how to formulate this problem in JuMP<a class="anchor-link" href="#Let's-see-how-to-formulate-this-problem-in-JuMP">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span class="c">#import necessary packages and define model</span>
<span class="k">using</span> <span class="n">JuMP</span>
<span class="n">master</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>

<span class="c">#If Gurobi is installed (requires license), you may uncomment the code below to switch solvers</span>
<span class="c">#using Gurobi</span>
<span class="c">#master = Model(solver=GurobiSolver(Method=0))  # Switch LP algorithm to Primal Simplex, in order to enjoy warm start</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[1]:</div>


<div class="output_latex output_subarea output_execute_result">
$$ \begin{alignat*}{1}\min\quad & 0\\
\text{Subject to} \quad\end{alignat*}
 $$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We are now going to initialize a <strong><em>"restricted master problem"</em></strong> with only two variables, corresponding two cutting patterns:</p>
<ul>
<li>width (14,31,36,45), quantity (1,1,0,1), denoted as $x_1$</li>
<li>width (14,31,36,45), quantity (0,0,2,0), denoted as $x_2$</li>
</ul>
<p><strong>[Recall 1]</strong> what's the meaning of each variable? <em>Number of paper rolls cut using this pattern.</em></p>
<p><strong>[Recall 2]</strong> How should the formulation of the restricted master problem look like?</p>
$$
\begin{align}
\nonumber\min\qquad\qquad\quad &x_1+x_2 \\
s.t.\qquad\left( \begin{array}{c}
1 \\
1 \\
0 \\
1 \end{array} \right)&x_1+\left( \begin{array}{c}
0 \\
0 \\
2 \\
0 \end{array} \right)x_2 \ge \left( \begin{array}{c}
211 \\
395 \\
610 \\
97 \end{array} \right) \\ 
&x_1,x_2\ge0
\end{align}$$
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span class="c">#define initial variables</span>
<span class="p">@</span><span class="n">defVar</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c">#width</span>
<span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="mi">14</span> <span class="mi">31</span> <span class="mi">36</span> <span class="mi">45</span><span class="p">]</span>

<span class="c">#constraint coefficient for initial variables</span>
<span class="n">A</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">;</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">b</span><span class="o">=</span><span class="p">[</span><span class="mi">211</span><span class="p">;</span> <span class="mi">395</span><span class="p">;</span> <span class="mi">610</span><span class="p">;</span> <span class="mi">97</span><span class="p">]</span>


<span class="c">#define constraint references</span>
<span class="p">@</span><span class="n">defConstrRef</span> <span class="n">myCons</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>

<span class="c">#define constraints</span>
<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span>
    <span class="n">myCons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">@</span><span class="n">addConstraint</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">vec</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,:]))</span><span class="o">&gt;=</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="k">end</span>

<span class="c">#define objective</span>
<span class="p">@</span><span class="n">setObjective</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">Min</span><span class="p">,</span> <span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">master</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[2]:</div>


<div class="output_latex output_subarea output_execute_result">
$$ \begin{alignat*}{1}\min\quad & x_{1} + x_{2}\\
\text{Subject to} \quad & x_{1} \geq 211\\
 & x_{1} \geq 395\\
 & 2 x_{2} \geq 610\\
 & x_{1} \geq 97\\
 & x_{i} \geq 0 \quad\forall i \in \{1,2\}\\
\end{alignat*}
 $$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span class="n">status</span><span class="o">=</span><span class="n">solve</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
<span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c">#get the optimal solution</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Optimal Solution is:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;width: &quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

<span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-6</span>

<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
   
    <span class="k">if</span> <span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&gt;</span><span class="n">epsilon</span> 
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Cutting Pattern: &quot;</span><span class="p">,</span> <span class="n">A</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="s">&quot;, Number of Paper Rolls Cut Using this Pattern: &quot;</span><span class="p">,</span> <span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
Optimal Solution is:

width: [14 31 36 45]
Cutting Pattern: [1,1,0,1], Number of Paper Rolls Cut Using this Pattern: 395.0
Cutting Pattern: [0,0,2,0], Number of Paper Rolls Cut Using this Pattern: 305.0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>[Result Analysis]</strong></p>
<p>The minimal number of paper rolls is 700.</p>
<p>Clearly this is not the best we can do, because we are not considering all possible feasible patterns.</p>
<p>Let's now generate some new patterns based on the value of reduced costs. Denote $r=(r_1,r_2,r_3,r_4)$ as the optimal dual price of constraints 1, 2, 3, 4. The reduced cost of a potential variable $x_k$, with cutting pattern $A_k$ can be calculated as
$$rc(x_k)=1-A_k^Tr$$</p>
<p>We want to add a potential variable $x_k$ such that $rc(x_k)<0$, this can be done by solving the following sub-problem:</p>
$$\begin{align}
z^*=\max\qquad &r_1a_{k,1}+r_2a_{k,2}+r_3a_{k,3}+r_4a_{k,4} \\
s.t.\qquad &14a_{k,1}+31a_{k,2}+36a_{k,3}+45a_{k,4}\le 100 \\
&a_{k,1},a_{k,2},a_{k,3},a_{k,4}\ge0,~\textrm{and are integers}
\end{align}$$<p>If $z^*>1$, then $x_k$ with cutting pattern $(a_{k,1},a_{k,2},a_{k,3},a_{k,4})$ should be added to the master problem. And resolve the master problem.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span class="n">r</span><span class="o">=</span><span class="p">[</span><span class="n">getDual</span><span class="p">(</span><span class="n">myCons</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]]</span>

<span class="n">sub</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>  

<span class="c">#width</span>
<span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">45</span><span class="p">]</span>

<span class="c">#define cutting pattern variables</span>
<span class="p">@</span><span class="n">defVar</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span>

<span class="c">#define feasible cutting constraint</span>
<span class="p">@</span><span class="n">addConstraint</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">100</span><span class="p">)</span>

<span class="c">#define objective</span>
<span class="p">@</span><span class="n">setObjective</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">Max</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">a</span><span class="p">))</span>

<span class="n">sub</span>

<span class="n">status</span><span class="o">=</span><span class="n">solve</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>

<span class="c">#print new cutting pattern</span>
<span class="n">pattern</span><span class="o">=</span><span class="p">[</span><span class="n">getValue</span><span class="p">(</span><span class="n">a</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]]</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;width: &quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">New Cutting Pattern: &quot;</span><span class="p">,</span> <span class="n">int</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>width: [14,31,36,45]

New Cutting Pattern: [0,3,0,0]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>[Result Analysis]</strong></p>
<p>The reduced cost of this variable is $(1-3)=-2<0$. Add this new variable to the <strong><em>"restricted master problem"</em></strong>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span class="c">#model before adding new column</span>
<span class="n">master</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[5]:</div>


<div class="output_latex output_subarea output_execute_result">
$$ \begin{alignat*}{1}\min\quad & x_{1} + x_{2}\\
\text{Subject to} \quad & x_{1} \geq 211\\
 & x_{1} \geq 395\\
 & 2 x_{2} \geq 610\\
 & x_{1} \geq 97\\
 & x_{i} \geq 0 \quad\forall i \in \{1,2\}\\
\end{alignat*}
 $$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>JuMP supports column-wise modeling in defining variables. Think about it, when we add a new variable to the existing model, we need to know:</p>
<ul>
<li>What's the coefficient for this new variable in the objective function?</li>
<li>Which constraint does this new variable appear? With what coefficient?</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span class="c">#column-wise adding new variable z</span>
<span class="p">@</span><span class="n">defVar</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">z</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inconstraints</span><span class="o">=</span><span class="n">myCons</span><span class="p">,</span> <span class="n">coefficients</span><span class="o">=</span><span class="n">pattern</span><span class="p">)</span>

<span class="c">#look at the master problem again</span>
<span class="n">master</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[6]:</div>


<div class="output_latex output_subarea output_execute_result">
$$ \begin{alignat*}{1}\min\quad & x_{1} + x_{2} + z\\
\text{Subject to} \quad & x_{1} \geq 211\\
 & x_{1} + 2.9999999999999996 z \geq 395\\
 & 2 x_{2} \geq 610\\
 & x_{1} \geq 97\\
 & x_{i} \geq 0 \quad\forall i \in \{1,2\}\\
 & z \geq 0\\
\end{alignat*}
 $$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span class="c">#solve the master problem again</span>
<span class="n">status</span><span class="o">=</span><span class="n">solve</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>

<span class="c">#get the optimal solution</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Optimal Solution is:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;width: &quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   
    <span class="k">if</span> <span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&gt;</span><span class="n">epsilon</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Cutting Pattern: &quot;</span><span class="p">,</span> <span class="n">A</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="s">&quot;, Number of Paper Rolls Cut Using this Pattern: &quot;</span><span class="p">,</span> <span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">end</span>
<span class="k">end</span>


<span class="k">if</span> <span class="n">getValue</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">&gt;</span><span class="n">epsilon</span>
    <span class="n">println</span><span class="p">(</span><span class="s">&quot;Cutting Pattern: &quot;</span><span class="p">,</span> <span class="n">int</span><span class="p">(</span><span class="n">pattern</span><span class="p">),</span> <span class="s">&quot;, Number of Paper Rolls Cut Using this Pattern: &quot;</span><span class="p">,</span> <span class="n">getValue</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
<span class="k">end</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
Optimal Solution is:

width: [14,31,36,45]
Cutting Pattern: [1,1,0,1], Number of Paper Rolls Cut Using this Pattern: 211.0
Cutting Pattern: [0,0,2,0], Number of Paper Rolls Cut Using this Pattern: 305.0
Cutting Pattern: [0,3,0,0], Number of Paper Rolls Cut Using this Pattern: 61.33333333333334
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>[Result Analysis]</strong></p>
<p>We see that after adding a new variable, the objective value is reduced to 577.3</p>
<h3 id="Now-it's-time-to-put-all-pieces-together">Now it's time to put all pieces together<a class="anchor-link" href="#Now-it's-time-to-put-all-pieces-together">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span class="c">#import necessary packages and define master problem</span>
<span class="k">using</span> <span class="n">JuMP</span><span class="p">,</span> <span class="n">Cbc</span>
<span class="n">master</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span> 

<span class="c">#If Gurobi is installed (requires license), you may uncomment the code below to switch solvers</span>
<span class="c">#using Gurobi</span>
<span class="c">#master = Model(solver=GurobiSolver(Method=0))  # Switch LP algorithm to Primal Simplex, in order to enjoy warm start</span>

<span class="c">#define initial variables</span>
<span class="p">@</span><span class="n">defVar</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c">#constraint coefficient for initial variables</span>
<span class="n">A</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">;</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">b</span><span class="o">=</span><span class="p">[</span><span class="mi">211</span><span class="p">;</span> <span class="mi">395</span><span class="p">;</span> <span class="mi">610</span><span class="p">;</span> <span class="mi">97</span><span class="p">]</span>

<span class="c">#define constraint references (why?)</span>
<span class="p">@</span><span class="n">defConstrRef</span> <span class="n">myCons</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>

<span class="c">#define constraints</span>
<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span>
    <span class="n">myCons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">@</span><span class="n">addConstraint</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">vec</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,:]))</span><span class="o">&gt;=</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="k">end</span>

<span class="c">#define objective</span>
<span class="p">@</span><span class="n">setObjective</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">Min</span><span class="p">,</span> <span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="c">#solve master problem</span>
<span class="n">solve</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;Iteration 1, Master Problem Objective Value:&quot;</span><span class="p">,</span> <span class="n">getObjectiveValue</span><span class="p">(</span><span class="n">master</span><span class="p">))</span>

<span class="c">#subproblem to iteratively generate new columns</span>

<span class="c">#get optimal dual prices from the master problem</span>
<span class="n">r</span><span class="o">=</span><span class="p">[</span><span class="n">getDual</span><span class="p">(</span><span class="n">myCons</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]]</span>

<span class="n">sub</span><span class="o">=</span><span class="n">Model</span><span class="p">()</span>  

<span class="c">#width</span>
<span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">45</span><span class="p">]</span>

<span class="c">#define cutting pattern variables</span>
<span class="p">@</span><span class="n">defVar</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span>

<span class="c">#define feasible cutting constraint</span>
<span class="p">@</span><span class="n">addConstraint</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">100</span><span class="p">)</span>

<span class="c">#define objective</span>
<span class="p">@</span><span class="n">setObjective</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">Max</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">a</span><span class="p">))</span>

<span class="c">#solve the subproblem</span>
<span class="n">solve</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>

<span class="n">sub_obj</span><span class="o">=</span><span class="n">getObjectiveValue</span><span class="p">(</span><span class="n">sub</span><span class="p">);</span>

<span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">;</span> 

<span class="c">#list of new variables</span>
<span class="n">newColumns</span><span class="o">=</span><span class="n">Variable</span><span class="p">[]</span>
<span class="c">#pattern list</span>
<span class="n">A_new</span><span class="o">=</span><span class="kt">Float64</span><span class="p">[];</span>

<span class="n">iter</span><span class="o">=</span><span class="mi">2</span>

<span class="k">while</span> <span class="n">sub_obj</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">+</span><span class="n">epsilon</span>  <span class="c">#why?</span>

    <span class="c">#cutting pattern (constraint coefficients) for the new variable</span>
    <span class="n">pattern</span><span class="o">=</span><span class="n">getValue</span><span class="p">(</span><span class="n">a</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
    
    <span class="c">#column-wise adding new variable z</span>
    <span class="p">@</span><span class="n">defVar</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">z</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inconstraints</span><span class="o">=</span><span class="n">myCons</span><span class="p">,</span> <span class="n">coefficients</span><span class="o">=</span><span class="n">pattern</span><span class="p">)</span>
    
    <span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">Add a new variable with cutting pattern: &quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="s">&quot;, reduced cost: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sub_obj</span><span class="p">))</span>
    
    <span class="c">#add new variable to the new variable list</span>
    <span class="n">push</span><span class="o">!</span><span class="p">(</span><span class="n">newColumns</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="c">#add new cutting pattern to pattern list</span>
    <span class="n">append</span><span class="o">!</span><span class="p">(</span><span class="n">A_new</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
    
    <span class="n">solve</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
    
    <span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Iteration &quot;</span><span class="p">,</span><span class="n">iter</span><span class="p">,</span> <span class="s">&quot;, Master Problem Objective Value:&quot;</span><span class="p">,</span> <span class="n">getObjectiveValue</span><span class="p">(</span><span class="n">master</span><span class="p">))</span>
    
    <span class="c">#get new optimal dual prices</span>
    <span class="n">r</span><span class="o">=</span><span class="p">[</span><span class="n">getDual</span><span class="p">(</span><span class="n">myCons</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]]</span>
    
    <span class="c">#modify the objective of the subproblem based on new dual prices</span>
    <span class="p">@</span><span class="n">setObjective</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">Max</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">a</span><span class="p">))</span>
    
    <span class="n">solve</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
    
    <span class="n">sub_obj</span><span class="o">=</span><span class="n">getObjectiveValue</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
    
    <span class="n">iter</span><span class="o">=</span><span class="n">iter</span><span class="o">+</span><span class="mi">1</span>
    
<span class="k">end</span>

<span class="c">#print optimal solution</span>
<span class="n">A_new</span><span class="o">=</span><span class="n">reshape</span><span class="p">(</span><span class="n">A_new</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="nb">convert</span><span class="p">(</span><span class="kt">Int64</span><span class="p">,</span><span class="n">length</span><span class="p">(</span><span class="n">A_new</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Optimal Solution is:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;width: &quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   
    <span class="k">if</span> <span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&gt;</span><span class="n">epsilon</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Cutting Pattern: &quot;</span><span class="p">,</span> <span class="n">A</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="s">&quot;, Number of Paper Rolls Cut Using this Pattern: &quot;</span><span class="p">,</span> <span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">newColumns</span><span class="p">)</span>
   
    <span class="k">if</span> <span class="n">getValue</span><span class="p">(</span><span class="n">newColumns</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&gt;</span><span class="n">epsilon</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Cutting Pattern: &quot;</span><span class="p">,</span> <span class="n">int</span><span class="p">(</span><span class="n">A_new</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="s">&quot;, Number of Paper Rolls Cut Using this Pattern: &quot;</span><span class="p">,</span> <span class="n">getValue</span><span class="p">(</span><span class="n">newColumns</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Iteration 1, Master Problem Objective Value:700.0
	Add a new variable with cutting pattern: [0.0,2.9999999999999996,0.0,0.0], reduced cost: -2.0

Iteration 2, Master Problem Objective Value:577.3333333333334
	Add a new variable with cutting pattern: [7.000000000000001,0.0,0.0,0.0], reduced cost: -3.666666666666666

Iteration 3, Master Problem Objective Value:517.6190476190477
Presolve 0 (-1) rows, 0 (-4) columns and 0 (-4) elements
Optimal - objective value 1
After Postsolve, objective 1, infeasibilities - dual 0 (0), primal 0 (0)
Optimal objective 1 - 0 iterations time 0.002, Presolve 0.00
Cbc0045I Solution with objective value -1 saved
	Add a new variable with cutting pattern: [2.0,0.0,2.0,0.0], reduced cost: -0.2857142857142856

Iteration 4, Master Problem Objective Value:501.33333333333337
Presolve 0 (-1) rows, 0 (-4) columns and 0 (-4) elements
Optimal - objective value 1
After Postsolve, objective 1, infeasibilities - dual 0 (0), primal 0 (0)
Optimal objective 1 - 0 iterations time 0.002, Presolve 0.00
Cbc0045I Solution with objective value -1 saved
	Add a new variable with cutting pattern: [0.0,0.0,0.0,2.0], reduced cost: -0.33333333333333326

Iteration 5, Master Problem Objective Value:485.1666666666667
Presolve 0 (-1) rows, 0 (-4) columns and 0 (-4) elements
Optimal - objective value 1
After Postsolve, objective 1, infeasibilities - dual 0 (0), primal 0 (0)
Optimal objective 1 - 0 iterations time 0.002, Presolve 0.00
Cbc0045I Solution with objective value -1 saved
Presolve 0 (-1) rows, 0 (-4) columns and 0 (-4) elements
Optimal - objective value 1
After Postsolve, objective 1, infeasibilities - dual 0 (0), primal 0 (0)
Optimal objective 1 - 0 iterations time 0.002, Presolve 0.00
Cbc0045I Solution with objective value -1 saved
	Add a new variable with cutting pattern: [0.0,2.0,1.0,0.0], reduced cost: -0.16666666666666674

Iteration 6, Master Problem Objective Value:452.25

Optimal Solution is:

width: [14,31,36,45]
Cutting Pattern: [2,0,2,0], Number of Paper Rolls Cut Using this Pattern: 206.25
Cutting Pattern: [0,0,0,2], Number of Paper Rolls Cut Using this Pattern: 48.5
Cutting Pattern: [0,2,1,0], Number of Paper Rolls Cut Using this Pattern: 197.5
Presolve 0 (-1) rows, 0 (-4) columns and 0 (-4) elements
Optimal - objective value 1
After Postsolve, objective 1, infeasibilities - dual 0 (0), primal 0 (0)
Optimal objective 1 - 0 iterations time 0.002, Presolve 0.00
Cbc0045I Solution with objective value -1 saved
Coin0505I Presolved problem not optimal, resolve after postsolve
Coin0505I Presolved problem not optimal, resolve after postsolve
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p><strong>[Exercise and Discussion]</strong>:</p>
<ul>
<li>Change the initial variables we use to construct the first restricted master problem (but still maintain the starting restricted master problem feasible). How does it effect the convergence of the algorithm? (number of total columns generated?)</li>
<li>Could you find a way to generate multiple columns whose reduced cost are less than 0 at one iteration?</li>
</ul>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="How-to-obtain-INTEGER-solution?">How to obtain INTEGER solution?<a class="anchor-link" href="#How-to-obtain-INTEGER-solution?">&#182;</a></h3><p>We solve the LP relaxation successfully using column generation, however the original cutting stock problem is an integer program. Can we apply column generation to obtain optimal integer solution?</p>
<p>The answer is <em>Yes</em>. However, it involves an advanced solution methodology called <a href="http://en.wikipedia.org/wiki/Branch_and_price">branch-and-price</a> where column generation is applied on each node of the branch-and-bound tree. Unfortunately, commercial solvers (Gurobi, CPLEX) don't support this feature. Till now, the only academic solver supports branch-and-price is <a href="http://scip.zib.de/">SCIP</a>.</p>
<p>Instead of solving the integer program to optimality, we here introduce two approximation methods that are widely used in solving real-world problems.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Method-1:-Rounding">Method 1: Rounding<a class="anchor-link" href="#Method-1:-Rounding">&#182;</a></h4><p>Rounding a fractional solution to its <em>nearest</em> and <em>feasible</em> is a common heuristic for solving integer program. It's pretty problem specific. In cutting stock problem, we observe that if we <em>round up</em> all the fractional solutions, feasibility will maintain. Thus we get our first integer solution:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Integer Solution Based on Rounding is:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;width: &quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

<span class="n">summation</span><span class="o">=</span><span class="mi">0</span>

<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   
    <span class="k">if</span> <span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&gt;</span><span class="n">epsilon</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Cutting Pattern: &quot;</span><span class="p">,</span> <span class="n">A</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="s">&quot;, Number of Paper Rolls Cut Using this Pattern: &quot;</span><span class="p">,</span> <span class="n">ceil</span><span class="p">(</span><span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
        <span class="n">summation</span><span class="o">=</span><span class="n">summation</span><span class="o">+</span><span class="n">ceil</span><span class="p">(</span><span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">newColumns</span><span class="p">)</span>
   
    <span class="k">if</span> <span class="n">getValue</span><span class="p">(</span><span class="n">newColumns</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&gt;</span><span class="n">epsilon</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Cutting Pattern: &quot;</span><span class="p">,</span> <span class="n">int</span><span class="p">(</span><span class="n">A_new</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="s">&quot;, Number of Paper Rolls Cut Using this Pattern: &quot;</span><span class="p">,</span> <span class="n">ceil</span><span class="p">(</span><span class="n">getValue</span><span class="p">(</span><span class="n">newColumns</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
        <span class="n">summation</span><span class="o">=</span><span class="n">summation</span><span class="o">+</span><span class="n">ceil</span><span class="p">(</span><span class="n">getValue</span><span class="p">(</span><span class="n">newColumns</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;Total Number of Paper Rolls Used: &quot;</span><span class="p">,</span> <span class="n">summation</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
Integer Solution Based on Rounding is:

width: [14,31,36,45]
Cutting Pattern: [2,0,2,0], Number of Paper Rolls Cut Using this Pattern: 207.0
Cutting Pattern: [0,0,0,2], Number of Paper Rolls Cut Using this Pattern: 49.0
Cutting Pattern: [0,2,1,0], Number of Paper Rolls Cut Using this Pattern: 198.0
Total Number of Paper Rolls Used: 454.0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We now have an integer solution using 454.0 paper rolls in total. Can we do better?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Method-2:-Branch-and-Bound-on-Root-Node">Method 2: Branch-and-Bound on Root Node<a class="anchor-link" href="#Method-2:-Branch-and-Bound-on-Root-Node">&#182;</a></h4><p>It is troublesome to implement column generation on every node of the branch and bound tree. A common industry / research practice is to directly branch-and-bound the model only with columns generated from solving the LP relaxation. This is a heuristic because optimal set of cutting patterns for the IP might not be the same as the LP relaxation, i.e. we might lose some "good columns" to reach optimal integer solution. The upside is, it is very easy to implement with commercial solvers.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span class="c">#change the solver from Clp to Cbc in order to get support for integer variables</span>
<span class="c">#if you use Gurobi as your solver choice, you don&#39;t need to switch solver.</span>

<span class="n">setSolver</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">CbcSolver</span><span class="p">())</span>

<span class="c">#change variable type from continuous to integer</span>

<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">setCategory</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">:</span><span class="kt">Int</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">newColumns</span><span class="p">)</span>
    <span class="n">setCategory</span><span class="p">(</span><span class="n">newColumns</span><span class="p">[</span><span class="n">i</span><span class="p">],:</span><span class="kt">Int</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">solve</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>


<span class="c">#print optimal solution</span>



<span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Integer Solution Based on Branch-and-Bound is:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;width: &quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

<span class="n">summation</span><span class="o">=</span><span class="mi">0</span>

<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   
    <span class="k">if</span> <span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&gt;</span><span class="n">epsilon</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Cutting Pattern: &quot;</span><span class="p">,</span> <span class="n">A</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="s">&quot;, Number of Paper Rolls Cut Using this Pattern: &quot;</span><span class="p">,</span> <span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">summation</span><span class="o">=</span><span class="n">summation</span><span class="o">+</span><span class="n">getValue</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">newColumns</span><span class="p">)</span>
   
    <span class="k">if</span> <span class="n">getValue</span><span class="p">(</span><span class="n">newColumns</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&gt;</span><span class="n">epsilon</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Cutting Pattern: &quot;</span><span class="p">,</span> <span class="n">int</span><span class="p">(</span><span class="n">A_new</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="s">&quot;, Number of Paper Rolls Cut Using this Pattern: &quot;</span><span class="p">,</span> <span class="n">getValue</span><span class="p">(</span><span class="n">newColumns</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">summation</span><span class="o">=</span><span class="n">summation</span><span class="o">+</span><span class="n">getValue</span><span class="p">(</span><span class="n">newColumns</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;Total Number of Paper Rolls Used: &quot;</span><span class="p">,</span> <span class="n">summation</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
Integer Solution Based on Branch-and-Bound is:

width: [14,31,36,45]
Cutting Pattern: [0,0,2,0], Number of Paper Rolls Cut Using this Pattern: 100.99999999999999
Cutting Pattern: [2,0,2,0], Number of Paper Rolls Cut Using this Pattern: 106.0
Cutting Pattern: [0,0,0,2], Number of Paper Rolls Cut Using this Pattern: 49.0
Cutting Pattern: [0,2,1,0], Number of Paper Rolls Cut Using this Pattern: 198.0
Total Number of Paper Rolls Used: 454.0
Presolve 0 (-4) rows, 0 (-7) columns and 0 (-11) elements
Optimal - objective value 453
After Postsolve, objective 453, infeasibilities - dual 0 (0), primal 0 (0)
Optimal objective 453 - 0 iterations time 0.002, Presolve 0.00
Cbc0045I Warning 3 integer variables were more than 1.0e-4 away from integer
Cbc0045I Given objective value 452.25, computed 453
Cbc0045I Solution with objective value 453 saved
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We save one paper roll by using method 2</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p><strong>[Question]:</strong></p>
<p>Is method 2 always able to produce feasible integer solution?</p>
</blockquote>

</div>
</div>
</div>    </div> <!-- /container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <!-- MathJax -->
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  </body>
</html>
